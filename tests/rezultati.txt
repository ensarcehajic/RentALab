============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.4.1, pluggy-1.6.0
rootdir: /home/habve/RentALab
plugins: mock-3.14.1, flask-1.3.0
collected 8 items

tests/test_login.py ......F.                                             [100%]

=================================== FAILURES ===================================
_________________________________ test_logout __________________________________

client = <FlaskClient <Flask 'App'>>
init_db = <SQLAlchemy postgresql://admin:***@localhost:5432/rentalab>

    def test_logout(client, init_db):
        """Test logout functionality"""
        # First login
        client.post('/login', data={
            'email': 'admin@fet.ba',
            'password': 'admin123'
        })
    
        # Verify session has user and role before logout
        with client.session_transaction() as session:
            assert session.get('user') == 'admin@fet.ba'
            assert session.get('role') == 'admin'
    
        # Then logout
        response = client.get('/logout', follow_redirects=True)
    
        assert response.status_code == 200
        assert b'login' in response.data.lower()
    
        # Check session is completely empty except for Flask's internal keys
        with client.session_transaction() as session:
            # Flask might add some internal keys like '_fresh', '_id', etc.
            # We only care about our custom keys being removed
            assert 'user' not in session
>           assert 'role' not in session
E           AssertionError: assert 'role' not in <SecureCookieSession {'_fresh': False, 'role': 'admin'}>

tests/test_login.py:206: AssertionError
=========================== short test summary info ============================
FAILED tests/test_login.py::test_logout - AssertionError: assert 'role' not i...
========================= 1 failed, 7 passed in 5.21s ==========================
